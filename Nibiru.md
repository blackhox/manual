# 1. Подготовка ОС Linux к установке ноды

 1.1 Обновновляем пакеты и систему

sudo apt update && sudo apt upgrade -y

# 1.2 Устанавливаем все необходимые пакеты и компоненты:

sudo apt install wget curl jq make git build-essential cmake gcc pkg-config libssl-dev -y

Для правильной и более безопасной работы с ОС Linux, рекомендуется создавать отдельного пользователя и не работатать от имени root. Но в случае тестнетов, которые, как правило, длятся не более 1 месяца,
я часто пользуюсь встроенной в систему администраторской учетной записью.
Если вы решите создать отдельного пользователя и дать ему права на установку в системе, то это можно сделать с помощью следующих команд:

adduser <имя пользователя>

usermod -aG sudo <имя пользователя>

su -l <имя пользователя>

Я не буду создавать нового пользователя и продолжу установку от имени root

# 2. Устанавливаем GO

Если ОС на сервере не "чистая" ранее ставились какие-то проекты, то рекомендуется сначала удалить все предыдущие версии:

sudo rm -rf /usr/local/go

а затем установить необходимую версии GO.

Для данного проекта необходим Go 1.16.0+, поэтому смело можно устанавливать 1.16.7

Запустим скачивание, распаковку и установку GO:

curl https://dl.google.com/go/go1.16.7.linux-amd64.tar.gz | sudo tar -C /usr/local -zxvf -

# 3. Экспортируем переменные:

cat <<'EOF' >>$HOME/.profile

export GOPATH=$HOME/go

export GO111MODULE=on

export PATH=$PATH:/usr/local/go/bin:$HOME/go/bin

EOF

source $HOME/.profile

# 4. Проверяем коректность установки, запустим команду:

go version 

В выводе должно быть:

go version go1.16.7 linux/amd64


# 5. Установка NIBIRU
Скачаем и скомпиллируем исходники проекта:

git clone https://github.com/cosmos-gaminghub/nibiru.git

Переходим в папку проекта и устанавливаем последнюю версию:

cd nibiru

git checkout -b tag0.3 tags/v0.3

make install


Ждем окончания сборки и проверяем ее корректность:


nibirud version

В выводе должно быть:

0.3

Проинициализируем ноду командой:


nibirud init <your_moniker> --chain-id=nibiru-2000


После этой команды вашем домашнем каталоге будет создана папка .nibirud

# 6. Загрузим последний файл Genesis, выполнив следующую команду:

curl -o $HOME/.nibiru/config/genesis.json https://raw.githubusercontent.com/cosmos-gaminghub/testnets/master/latest/genesis.json

Проверяем контрольную сумму файла генезиса:

shasum -a 256 genesis.json

Должна совпадать с указанной ниже:


12b40d0c660e65f5a78e6b5bd90298a4d3cdeffeb5fdcb069ee789d254c2fdad  genesis.json

# 7. Внесем информацию о начальных узлах в config.toml для синхронизации с сетью

Для этого отредактируем конфигурационный файл:

nano $HOME/.nibiru/config/config.toml

Находим раздел P2P и в нем пункт Seed.

Вносим внего следующую строку:

42de54ab0ea03b96b28ca43818d9d27cbeb231bc@167.179.117.190:26656

# 8. Запустим процесс синхронизации:

screen -S nibirud

nibirud start

Убеждаемся что процесс синхронизации запустился и отключаемся от сеанса SCREEN, для этого нажимаем <Ctr+A> и D.

Проверяем что нода засинхронизирована при помощи команды:

nibirud status | jq .sync_info

Должен быть статус: "false"

# 7. Создаем кошелек

Если у вас уже был кошелек этого проекта, то его можно импортировать (восстановить), если кошелька не было, то его необходимо создать.

Для создания кошелка необходимо выполнить следующую команду:

nibirud keys add <wallet_name>

Команда создасть адрес кошелька и выведет ключевые слова, для восстановления. 
# Их необходимо ОБЯЗАТЕЛЬНО СОХРАНИТЬ!!!!

# 8. Создание валидатора

Для того, чтобы создать валидатора необходимы токены проекта, для оплаты за транзакцию в сети.
Переходим в дискорд проекта:
https://docs.cosmosgaminghub.com/testnets/discord.gg/VfvTCP7Rm2

и запрашиваем токены (канал nibiru-2000-faucet):
формат команды следующий:

/faucet address:<адрес созданного вами кошелька>

Там работает выпадающая подсказка, можно ей воспользоваться, чтобы транзакции точно прошла.

Убедиться, что токены пришли к вам на кошелек можно при помощи следующей команды:

nibirud query bank balances <адрес созданного вами кошелька>

Если токены пришли, то приступаем к созданию валидатора:

nibirud tx staking create-validator \

  --amount=1000game \
  
  --pubkey=$(nibirud tendermint show-validator) \
  
  --moniker=<имя ноды> \
  
  --chain-id=nibiru-2000 \
  
  --commission-rate="0.10" \
  
  --commission-max-rate="0.20" \
  
  --commission-max-change-rate="0.01" \
  
  --min-self-delegation="1" \
    
  --gas="auto" \
  
  --from=имя кошелька

Соглашаемся с оплаталой комиссии и после успешной транзакции, переходим в эксплорер проекта:https://nibiru-2000.game-explorer.io/validators
Быстрее всего ваш валидатор будет не активным, так как его адрес нужно забондить.

Для бондинга адреса валидатора нам нужен Operator address, вот такого формата: nibiruvaloper12345678

Нахогдим в эксплорере своего валидатора, клацаем по нему мышкой и видим там необходимый нам  Operator address.

Далее переводим на этот адрес любое кол-во токенов при помощи данной команды:

nibirud tx staking delegate nibiruvaloper123456789 500000000game --from <имя кошелька> --chain-id nibiru-2000 --gas auto

После успешного выполнения данной команды, видим своего валидатора в активных.
